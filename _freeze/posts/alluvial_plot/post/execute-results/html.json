{
  "hash": "3689c599a0dc8c1d3b3767a7ac03b35e",
  "result": {
    "markdown": "---\ntitle: 'How to Create an Aluvial Plot in R'\ndate: \"2024-02-22\"\ncategories: ['ggplot', 'plot', 'alluvial', 'R']\ndescription: \"How to draw an Alluvial Plot in R with example code.\"\nexecute: \n  message: false\n  warning: false\neditor_options: \n  chunk_output_type: console\nformat: \n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\n---\n\n\n# Introduction\n\nIn this post, I explain how to create an alluvial plot using code in R\n\n## What is an Alluvial Diagram\n\nAn alluvial diagram or plot displays the flow of information from one categorical variable or stage to the next. The term \"alluvial\" refers to its resemblance to the flow of a river.\n\n## Uses of Alluvial Diagrams\n\nAlluvial diagrams are commonly used in the following situations:\n\n* To demonstrate the number of participants in a study transitioning from one baseline category to a subsequent category. For example, the number of participants randomized at the beginning of the study and who continue to follow-up at the end. It serves as a graphical supplement to flowcharts, which present information with arrows and boxes containing text and numbers.\n* To show the distribution of participants among different categorical variables. In this case, it provides a more \"visually appealing\" alternative to stacked column charts.\n\n# R Code\n\n## Preparativos\n\nFor this example, we will use the `ggalluvial` and `ggplot2` libraries. The data come from a study on language learning using the web application *LingQ* ([Link to the article](http://comparelanguageapps.com/documentation/LingQ_Efficacy_2023.pdf)). \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary libraries\nlibrary(tidyverse) # Includes ggplot2\nlibrary(ggalluvial)\nlibrary(knitr)\n\n# Input data\n\ndata <- data.frame(\n  Initial = rep(c(\"First\", \"Second\", \"Third\", \"Fourth+\"), each = 4),\n  Final = rep(c(\"First\", \"Second\", \"Third\", \"Fourth+\"), 4), \n  Frequency = c(28, 28, 10, 4, 3, 6, 7, 5,\t0, 3, 3, 3, 0, 0, 0, 1)\n) %>% \n  mutate(\n    Initial = factor(Initial, levels = c(\"First\", \"Second\", \"Third\", \"Fourth+\")),\n    Final = factor(Final, levels = c(\"First\", \"Second\", \"Third\", \"Fourth+\"))\n  )\n\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Initial   Final Frequency\n1   First   First        28\n2   First  Second        28\n3   First   Third        10\n4   First Fourth+         4\n5  Second   First         3\n6  Second  Second         6\n```\n:::\n:::\n\n\nIn this study, a total of 192 individuals were selected for the sample and completed the initial knowledge test. Out of these, 101 completed the final test and studied for at least two hours in the application, and were included in the analysis. The data show the equivalent language knowledge in formal education semesters (\"First\", \"Second\", \"Third\", \"Fourth or more\") at the beginning of the study (\"Initial\") and after using the application (\"Final\").\n\n*Note: The data have been extracted from the example article from the result tables and are just an example of a data distribution compatible with those results.*\n\n## Alluvial Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>% \nggplot(aes(axis1 = fct_rev(Initial), axis2 = fct_rev(Final),\n           y = Frequency)) +\n  scale_x_discrete(limits = c(\"Initial\", \"Final\"), expand = c(.2, .05)) +\n  geom_alluvium(aes(fill = Final)) +\n  geom_stratum() +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum))) +\n  theme_minimal() +\n  labs(x = \"Equivalent formal education semesters\")\n```\n\n::: {.cell-output-display}\n![](post_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nIn the alluvial diagram, the area of the colored zones is proportional to the frequency, so wider \"flows\" represent more participants.\n\nThe graph shows how the majority of the flow occurs from bottom to top; that is, knowledge tends to improve more than deteriorate. For example, more than half of the participants who started from the first semester of knowledge progressed to the second, third, or fourth semester.\n\nIt can also be seen that almost all participants who ended with a knowledge level equivalent to the first semester started from that previous level, and a few decreased from the second semester to the first semester.\n\nIn conclusion, alluvial diagrams provide a visual option for better understanding data flows between categories.\n\n# References\n\n* [ggalluvial package](https://corybrunson.github.io/ggalluvial/)\n* [Language learning study with LingQ](http://comparelanguageapps.com/documentation/LingQ_Efficacy_2023.pdf)\n\n",
    "supporting": [
      "post_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}