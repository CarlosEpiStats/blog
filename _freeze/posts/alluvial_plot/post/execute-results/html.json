{
  "hash": "594b1e1816f6c357f6be73b0744992f7",
  "result": {
    "markdown": "---\ntitle: 'Diagrama aluvial (alluvial plot)'\ndate: \"2024-02-22\"\ncategories: ['ggplot', 'plot', 'alluvial']\ndescription: \"Cómo crear un diagrama aluvial en R.\"\nexecute: \n  message: false\n  warning: false\neditor_options: \n  chunk_output_type: console\n---\n\n\n# Introducción\n\nEn este post explico cómo crear un diagrama aluvial (*alluvial plot*) usando código en R.\n\n\n## Qué es un diagrama aluvial\n\nUn diagrama o gráfico aluvial muestra el flujo de información de un estadio al siguiente. El nombre \"aluvial\" alude a su parecido con el flujo de un río.\n\n## Para qué se usan los diagramas aluviales\n\nUn diagrama aluvial se suele utilizar en las siguientes situaciones:\n\n* Para mostrar el número de participantes de un estudio que cambian desde una categoría basal a una categoría siguiente. Por ejemplo, el número de participantes aleatorizados al principio del estudio y que continúan en seguimiento al final. Es un complemento gráfico a los diagramas de flujo, que presentan la información con flechas y cajas con texto y números.\n* Para mostrar la distribución de participantes entre distintas variables categóricas. En este caso es una alternativa más \"vistosa\" a los diagramas de columnas apilados.\n\n# Código en R\n\n## Preparativos\n\nPara este ejemplo, usaremos la biblioteca `ggalluvial` y `ggplot2`. Los datos proceden de un estudio sobre aprendizaje de idiomas usando la aplicación web *LingQ* ([Enlace al artículo](http://comparelanguageapps.com/documentation/LingQ_Efficacy_2023.pdf)). \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar las bibliotecas necesarias\nlibrary(tidyverse) # Incluye ggplot2\nlibrary(ggalluvial)\nlibrary(knitr)\n\n# Datos de ejemplo\n\ndata <- data.frame(\n  Inicial = rep(c(\"Primero\", \"Segundo\", \"Tercero\", \"Cuarto+\"), each = 4),\n  Final = rep(c(\"Primero\", \"Segundo\", \"Tercero\", \"Cuarto+\"), 4), \n  Frecuencia = c(28, 28, 10, 4, 3, 6, 7, 5,\t0, 3, 3, 3, 0, 0, 0, 1)\n) %>% \n  mutate(\n    Inicial = factor(Inicial, levels = c(\"Primero\", \"Segundo\", \"Tercero\", \"Cuarto+\")),\n    Final = factor(Final, levels = c(\"Primero\", \"Segundo\", \"Tercero\", \"Cuarto+\"))\n  )\n\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Inicial   Final Frecuencia\n1 Primero Primero         28\n2 Primero Segundo         28\n3 Primero Tercero         10\n4 Primero Cuarto+          4\n5 Segundo Primero          3\n6 Segundo Segundo          6\n```\n:::\n:::\n\n\nEn este estudio, un total de 192 personas fueron seleccionados para la muestra y completaron el test de conocimientos inicial. De ellas, 101 completaron el test final y estudiaron al menos dos horas en la aplicación, y fueron incluidas en el análisis. Los datos muestran cuál era el conocimiento de idiomas equivalente en semestres de educación formal (\"Primero\", \"Segundo\", \"Tercero\", \"Cuarto o más\") al principio del estudio (\"Inicial\") y tras usar la aplicación (\"Final\"). \n\n*Nota: Los datos se han extraído del artículo de ejemplo a partir de las tablas de resultados y son solo un ejemplo de una distribución de datos compatible con esos resultados.*\n\n## Gráfico\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Diagrama aluvial\ndata %>% \nggplot(aes(axis1 = fct_rev(Inicial), axis2 = fct_rev(Final),\n           y = Frecuencia)) +\n  scale_x_discrete(limits = c(\"Inicial\", \"Final\"), expand = c(.2, .05)) +\n  geom_alluvium(aes(fill = Final)) +\n  geom_stratum() +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum))) +\n  theme_minimal() +\n  labs(x = \"Semestres equivalentes de educación formal\")\n```\n\n::: {.cell-output-display}\n![](post_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nEn el diagrama aluvial, el área de las zonas coloreadas es proporcional a la frecuencia, por lo que \"flujos\" más anchos representan más participantes. \n\nEn el gráfico se aprecia cómo la mayor parte del flujo ocurre de abajo arriba; es decir, el conocimiento tiende a mejorar más que a empeorar. Por ejemplo, más de la mitad de los participantes que partían del primer semestre de conocimientos subieron al segundo, tercer o cuarto semestre. \n\nTambién se puede ver como casi todos los participantes que acabaron con un nivel de conocimientos equivalente al primer semestre partían de ese nivel previo, y unos pocos bajaron del segundo semestre al primer semestre.\n\nEn definitiva, los diagramas aluviales proporcionan una opción visual para entender mejor los flujos de datos entre categorías, especialmente si hay algún componente temporal asociado a ellas.\n\n# Referencias\n\n* [Biblioteca ggalluvial](https://corybrunson.github.io/ggalluvial/)\n* [Estudio de aprendizaje de idiomas con LingQ](http://comparelanguageapps.com/documentation/LingQ_Efficacy_2023.pdf)\n\n",
    "supporting": [
      "post_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}