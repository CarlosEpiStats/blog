{
  "hash": "95dd4dc50ec4cfbfc6dad647ba61c1e2",
  "result": {
    "markdown": "---\ntitle: \"Load Data from the National Health Survey Spain 2020\"\ndate: \"2024-06-25\"\ncategories: ['R', 'importing', 'data cleaning', 'ggplot2', 'tidyverse', 'health']\ndescription: \"A step-by-step guide to loading, cleaning, and visualizing data from the National Health Survey Spain 2020 using R.\"\nexecute: \n  message: false\n  warning: false\neditor_options: \n  chunk_output_type: console\nformat: \n  html\n---\n\n\n# Introduction\n\nIn this post, we will load, clean, and visualize data from the National Health Survey Spain 2020. This dataset provides valuable insights into the health status of the Spanish population, including information on age, sex, region, height, and weight.\n\nInformation about the Health Survey can be found on the [official page of the Spanish Health Ministry](https://www.sanidad.gob.es/estadEstudios/estadisticas/EncuestaEuropea/Enc_Eur_Salud_en_Esp_2020.htm). The data can be downloaded from [this webpage](https://www.sanidad.gob.es/estadisticas/microdatos.do).\n\n## Load Libraries\n\nFirst, we load the necessary libraries.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(\n  tidyverse, \n  scales\n)\n```\n:::\n\n\n# Import Data\n\nWe will import the data from a fixed-width file (`MICRODATOS_PUBLICACION_CADULTO.txt`) and focus on the columns for age, sex, region, height, and weight.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile_2020 <- \"MICRODATOS_PUBLICACION_CADULTO.txt\"\n\n# Read using read_fwf\ndata_raw <- read_fwf(\n  file_2020,\n  col_positions = fwf_cols(\n    sex = c(13, 13),\n    age = c(14, 16),\n    region = c(1, 2),\n    height = c(369, 371),\n    weight = c(372, 374)\n  ),\n  col_types = \"iiiii\", # set all columns as integers\n  na = c(\"998\",\"999\") # Missing values encoded as 998 (doesn't know) or 999 (doesn't answer)\n)\n\nglimpse(data_raw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 22,072\nColumns: 5\n$ sex    <int> 1, 2, 1, 2, 1, 2, 2, 2, 1, 2, 2, 1, 1, 2, 2, 1, 2, 1, 2, 2, 1, …\n$ age    <int> 60, 87, 38, 43, 41, 34, 60, 79, 87, 82, 77, 44, 47, 16, 48, 25,…\n$ region <int> 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16,…\n$ height <int> 175, NA, 174, 164, 169, 167, 159, 150, 178, NA, 155, 184, 181, …\n$ weight <int> 74, NA, 80, 58, 74, 90, NA, 73, 72, 64, NA, 86, 85, 56, 67, 87,…\n```\n:::\n:::\n\n\n# Clean Data\n\nNext, we clean the data by converting the sex and region columns to factors, calculating the Body Mass Index (BMI), and categorizing the BMI values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_clean <- data_raw |>\n  mutate(\n    sex = factor(sex, labels = c(\"Male\", \"Female\")),\n    region = factor(region, labels = c(\"Andalucía\", \"Aragón\", \"Asturias, Principado de\", \"Balears, Illes\",\t\"Canarias\",\t\"Cantabria\",\t\"Castilla y León\",\t\"Castilla - La Mancha\",\t\"Cataluña\",\t\"Comunitat Valenciana\",\t\"Extremadura\",\t\"Galicia\",\t\"Madrid, Comunidad de\",\t\"Murcia, Región de\",\t\"Navarra, Comunidad Foral de\",\t\"País Vasco\",\t\"Rioja, La\",\t\"Ceuta\",\t\"Melilla\")),\n    bmi = weight / (height/100) ^ 2,\n    bmi_cat = case_when(\n      bmi < 18.5 ~ \"Underweight\",\n      bmi >= 18.5 & bmi < 25 ~ \"Normal weight\",\n      bmi >= 25 & bmi < 30 ~ \"Overweight\",\n      bmi >= 30 ~ \"Obesity\"\n    ),\n    bmi_cat = fct(bmi_cat, levels = c(\"Underweight\", \"Normal weight\", \"Overweight\", \"Obesity\"))\n  ) \n\nglimpse(data_clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 22,072\nColumns: 7\n$ sex     <fct> Male, Female, Male, Female, Male, Female, Female, Female, Male…\n$ age     <int> 60, 87, 38, 43, 41, 34, 60, 79, 87, 82, 77, 44, 47, 16, 48, 25…\n$ region  <fct> \"País Vasco\", \"País Vasco\", \"País Vasco\", \"País Vasco\", \"País …\n$ height  <int> 175, NA, 174, 164, 169, 167, 159, 150, 178, NA, 155, 184, 181,…\n$ weight  <int> 74, NA, 80, 58, 74, 90, NA, 73, 72, 64, NA, 86, 85, 56, 67, 87…\n$ bmi     <dbl> 24.16327, NA, 26.42357, 21.56454, 25.90946, 32.27079, NA, 32.4…\n$ bmi_cat <fct> Normal weight, NA, Overweight, Normal weight, Overweight, Obes…\n```\n:::\n:::\n\n\n# Visualize Data\n\nWe will create two visualizations: a bar plot showing the proportion of different weight categories, and a combined histogram and density plot to visualize the BMI distribution by sex.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Bar plot of weight categories\ndata_clean |> \n  filter(!is.na(bmi_cat)) |> \n  ggplot(aes(x = bmi_cat, y = after_stat(prop), group = 1)) +\n  geom_bar() +\n  theme_classic() +\n  scale_y_continuous(labels = label_percent()) +\n  labs(\n    x = \"Weight category\",\n    y = \"Proportion of answers\",\n    title = \"A Substantial Proportion of Adult Spaniards have Overweight or Obesity\",\n    caption = \"Data source: Spanish European Health Survey 2020.\"\n  )\n```\n\n::: {.cell-output-display}\n![](post_files/figure-html/plots-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Histogram and density plots by sex\ndata_clean |> \n  ggplot(aes(x = bmi, fill = sex)) + \n  geom_histogram(\n    aes(y = after_stat(density)),\n    breaks = seq(10, 70, 1), \n    position = \"identity\", \n    alpha = 0.3) +\n  geom_density(aes(color = sex), alpha = 0.6) +\n  geom_vline(aes(xintercept = 25), linetype = \"dashed\") +\n  geom_vline(aes(xintercept = 30), linetype = \"dashed\") +\n  scale_y_continuous(expand = c(0, 0)) +\n  scale_x_continuous(\n    limits = c(15, 50),\n    breaks = seq(15, 50, 5)\n    ) +\n  theme_classic() +\n  labs(\n    y = \"Density\", \n    x = \"Body Mass Index (kg/m²)\",\n    fill = \"Sex\",\n    color = \"Sex\",\n    title = \"Males Have Higher BMI than Females, on Average\",\n    subtitle = \"Excess Weight is Highly Prevalent in Both Sexes\",\n    caption = \"Dashed lines represent thresholds of overweight (25 kg/m²) and obesity (30 kg/m²).\\nData source: Spanish European Health Survey 2020.\"\n  )\n```\n\n::: {.cell-output-display}\n![](post_files/figure-html/plots-2.png){width=672}\n:::\n:::\n\n\n# Plot Interpretation\n\n## Bar Plot of Weight Categories\n\nThe bar plot shows the proportion of individuals in each weight category (Underweight, Normal weight, Overweight, Obesity).\n\n-   **Overweight and Obesity Prevalence:** The plot highlights that a substantial proportion of the adult Spanish population falls into the overweight or obese categories.\n-   **Public Health Concern:** This high prevalence of overweight and obesity indicates significant public health concerns, as these conditions are associated with various health risks.\n\n## Histogram and Density Plots by Sex\n\nThe histogram and density plots provide a detailed view of the BMI distribution for males and females.\n\n-   **Sex Differences:** Males generally have higher BMI values than females, as indicated by the density curves. This is evident from the rightward shift in the male density curve compared to the female density curve.\n-   **Dashed Lines:** The vertical dashed lines at 25 kg/m² and 30 kg/m² represent the thresholds for overweight and obesity, respectively. The density curves show that many individuals have BMI values exceeding these thresholds.\n\n\n# Conclusion\n\nThe visualizations clearly indicate that excess weight is prevalent among the Spanish adult population, with males having higher BMI on average than females. This analysis underscores the importance of addressing overweight and obesity through public health initiatives and policies.\n\nBy following these steps, we successfully load, clean, and visualize the data from the National Health Survey Spain 2020, providing a foundation for further health-related analysis.\n\n# References:\n\n-   [Encuesta Europea de Salud en España 2020](https://www.sanidad.gob.es/estadEstudios/estadisticas/EncuestaEuropea/Enc_Eur_Salud_en_Esp_2020.htm)\n",
    "supporting": [
      "post_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}