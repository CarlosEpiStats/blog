<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>EpiStats</title>
<link>https://CarlosEpiStats.github.io/blog/blog.html</link>
<atom:link href="https://CarlosEpiStats.github.io/blog/blog.xml" rel="self" type="application/rss+xml"/>
<description>A blog about Epidemiology and Biostatistics by Carlos Fernández, MD MPH.</description>
<generator>quarto-1.3.353</generator>
<lastBuildDate>Mon, 26 Feb 2024 23:00:00 GMT</lastBuildDate>
<item>
  <title>Loading and Exploring Japanese Kanji Data Using R</title>
  <dc:creator>Carlos Fernández</dc:creator>
  <link>https://CarlosEpiStats.github.io/blog/posts/kanji/post.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this blog post, I’ll demonstrate how to use R to load, explore, and filter data from a dataset containing Japanese characters, known as “kanji”. The datasets were obtained from an online <a href="https://www.kanjidatabase.com/index.php">Kanji database</a>. We’ll focus on using the <code>tidyverse</code> family of packages to illustrate how to select and filter relevant information efficiently.</p>
</section>
<section id="setup-and-loading" class="level1">
<h1>Setup and Loading</h1>
<p>To begin, we need to load necessary libraries and import the datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># | warning: false</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Loading necessary libraries</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Loading datasets</span></span>
<span id="cb1-8"></span>
<span id="cb1-9">data_kanji <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv2</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/kanji"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kanji_20240227_081842.csv"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>()</span>
<span id="cb1-11"></span>
<span id="cb1-12">data_jukugo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv2</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/kanji"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jukugo_20240227_081908.csv"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>()</span></code></pre></div>
</div>
<p>Here’s a breakdown of the code:</p>
<ul>
<li><code>library(tidyverse)</code>: We load the <code>tidyverse</code> package, which includes <code>dplyr</code>, <code>ggplot2</code>, and other useful packages.</li>
<li><code>library(here)</code>: This package helps manage file paths conveniently.</li>
<li><code>library(janitor)</code>: Useful for standardizing variable names and data cleaning.</li>
<li>We use <code>read.csv2()</code> to import CSV (comma-separated value) files with semicolons (;) as separators.</li>
<li><code>here("data/kanji", "Kanji_20240227_081842.csv")</code> uses the function <code>here()</code> to access the data file, which is saved inside the folders data &gt; kanji.</li>
<li>The characters <code>%&gt;%</code> are called a “pipe” in tidyverse. It can be written simply by pressing Ctrl + Shift + M (in Windows). Basically, it tells R that we want to apply some step to the previous data. In this example, I tell R that I want to use the function <code>clean_names()</code> to the data that I’ve already loaded using <code>read.csv2()</code>.</li>
<li><code>clean_names()</code> is a <code>janitor</code> function that renames all variables in a standard format to make it easier to manipulate. Specifically, <code>clean_names()</code> sets all names to lowercase, removes punctuation and symbols, and replaces spaces with underscores.</li>
</ul>
<p>Now I have two separate datasets: one for kanji (single characters), and one for jukugo (compound words). Let’s take a look at them.</p>
</section>
<section id="exploring-the-data" class="level1">
<h1>Exploring the data</h1>
<p>Let’s examine the first few rows of each dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data_kanji)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id kanji strokes grade
1   41    一       1     1
2  124    乙       1     7
3 2060    了       2     7
4 2074    力       2     1
5 1577    二       2     1
6 1070    人       2     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data_jukugo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   id comp_word frequency          grammatical_feature pronunciation
1 173      一部     46289 possible to use as an adverb         itibu
2 234      一般     39274                 general noun         ippan
3 432      一時     25126 possible to use as an adverb         itizi
4 461      一番     24155 possible to use as an adverb        itiban
5 481      一緒     23453    light-verb -suru attached         issyo
6 529      一致     21388    light-verb -suru attached          itti
  english_translation position kanji kanji_id
1            one part        L    一       41
2             general        L    一       41
3         one o'clock        L    一       41
4                best        L    一       41
5            together        L    一       41
6         coincidence        L    一       41</code></pre>
</div>
</div>
<p>We’re using the base function <code>head()</code>to show the first rows or observations of our datasets.</p>
<p>We can see that <code>data_kanji</code> has four columns or variables:</p>
<ul>
<li><code>id</code> shows a unique identification number.</li>
<li><code>kanji</code> stores the actual character.</li>
<li><code>strokes</code> represents the number of distinct lines or strokes that the character has.</li>
<li><code>grade</code> means the official categorization of Kanji by educational year in Japan. Grade 1 includes the easiest or most common kanji, and it goes all up to grade 7.</li>
</ul>
<p>On the other hand, <code>data_jukugo</code> contains nine variables:</p>
<ul>
<li><code>id</code> is the identification number for jukugos.</li>
<li><code>comp_word</code> is the actual word.</li>
<li><code>frequency</code> is a measure of how many times each jukugo appear in a selected corpus of Japanese literature (extracted from Japanese newspapers).</li>
<li><code>grammatical_feature</code> gives us more context of how the word is used in grammatical terms.</li>
<li><code>pronunciation</code> tells us the pronunciation in “romaji”, or the Latin alphabet.</li>
<li><code>english_translation</code> stores the English translation.</li>
</ul>
<p>The last three variables in <code>data_jukugo</code> describes the kanji which is part of the jukugo:</p>
<ul>
<li><code>position</code> tells us if the kanji is used in left position “L” or right position “R”.</li>
<li><code>kanji</code> shows the kanji used in the jukugo. The first rows all show jukugos composed with the kanji “一”.</li>
<li><code>kanji_id</code> is the identification number of the kanji part. We can use this id to link <code>data_jukugo</code> with <code>data_kanji</code> if we want to.</li>
</ul>
<p>Another way of looking into a dataset is to explore how each variable is encoded:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(data_kanji)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,136
Columns: 4
$ id      &lt;int&gt; 41, 124, 2060, 2074, 1577, 1070, 1584, 829, 359, 1647, 1903, 1…
$ kanji   &lt;chr&gt; "一", "乙", "了", "力", "二", "人", "入", "七", "九", "八", "…
$ strokes &lt;int&gt; 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3,…
$ grade   &lt;int&gt; 1, 7, 7, 1, 1, 1, 1, 1, 1, 1, 7, 3, 1, 2, 1, 2, 6, 7, 6, 1, 2,…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(data_jukugo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 52,791
Columns: 9
$ id                  &lt;int&gt; 173, 234, 432, 461, 481, 529, 937, 1465, 1521, 156…
$ comp_word           &lt;chr&gt; "一部", "一般", "一時", "一番", "一緒", "一致", "…
$ frequency           &lt;int&gt; 46289, 39274, 25126, 24155, 23453, 21388, 12477, 7…
$ grammatical_feature &lt;chr&gt; "possible to use as an adverb", "general noun", "p…
$ pronunciation       &lt;chr&gt; "itibu", "ippan", "itizi", "itiban", "issyo", "itt…
$ english_translation &lt;chr&gt; "one part", "general", "one o'clock", "best", "tog…
$ position            &lt;chr&gt; "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", …
$ kanji               &lt;chr&gt; "一", "一", "一", "一", "一", "一", "一", "一", "…
$ kanji_id            &lt;int&gt; 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41…</code></pre>
</div>
</div>
<p>The <code>glimpse()</code> function allows us to quickly glance at the data structure.</p>
<p>We can see that <code>data_kanji</code> has 2,136 rows or observations and 4 columns or variables. We also see the first values of each of its four variables. More importantly, we can see which data type each variable stores. The <code>kanji</code> variable has <code>&lt;chr&gt;</code> type, which means “character” or “text”, while the rest of variables have <code>&lt;int&gt;</code> type, which means “integer” number, or a round number. R automatically detects the data types when importing data using functions like <code>read.csv2()</code>.</p>
<p>Regarding <code>data_jukugo</code>, it has 52,791 rows and 9 columns, of which 3 have <code>&lt;int&gt;</code> type, and 6 have <code>&lt;char&gt;</code> type.</p>
</section>
<section id="manipulating-the-data" class="level1">
<h1>Manipulating the data</h1>
<p>Now that I’m familiarized with this dataset, it’s useful to lay down what my analysis plan is. In other words, what do I want to learn from this data? In this case, I want to be able to find words (jukugo) that only contain kanji from a selected list of kanji that I’m learning. So, for example, if I only know kanjis 一, 人, and 十, I want to know all the possible combinations of these three kanjis.</p>
<p>For this exercise, I’m interested in separate jukugos in two parts: the left kanji, and the right kanji. The dataset already has half of this information, but sometimes it tells us the left kanji, and sometimes the right kanji (usually, the simplest kanji of the two). I want to get sistematically both left and right kanjis, so I’ll create new variables called <code>kanji_left</code> and <code>kanji_right</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">data_jukugo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_jukugo <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kanji_left =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substr</span>(comp_word, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb10-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kanji_right =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substr</span>(comp_word, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(data_jukugo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 52,791
Columns: 11
$ id                  &lt;int&gt; 173, 234, 432, 461, 481, 529, 937, 1465, 1521, 156…
$ comp_word           &lt;chr&gt; "一部", "一般", "一時", "一番", "一緒", "一致", "…
$ frequency           &lt;int&gt; 46289, 39274, 25126, 24155, 23453, 21388, 12477, 7…
$ grammatical_feature &lt;chr&gt; "possible to use as an adverb", "general noun", "p…
$ pronunciation       &lt;chr&gt; "itibu", "ippan", "itizi", "itiban", "issyo", "itt…
$ english_translation &lt;chr&gt; "one part", "general", "one o'clock", "best", "tog…
$ position            &lt;chr&gt; "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", …
$ kanji               &lt;chr&gt; "一", "一", "一", "一", "一", "一", "一", "一", "…
$ kanji_id            &lt;int&gt; 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41, 41…
$ kanji_left          &lt;chr&gt; "一", "一", "一", "一", "一", "一", "一", "一", "…
$ kanji_right         &lt;chr&gt; "部", "般", "時", "番", "緒", "致", "定", "連", "…</code></pre>
</div>
</div>
<p>Let’s explain the code:</p>
<ul>
<li><code>mutate()</code> is the <code>dplyr</code> function used to create or change variables. Here, I create two variables, <code>kanji_left</code> and <code>kanji_right</code>.</li>
<li><code>substr()</code> is a base function that subtracts a string of text from a character variable. <code>substr(comp_word, 1, 1)</code> means to subtract only the first character, and <code>substr(comp_word, 2, 2)</code> gets the second character.</li>
</ul>
<p>Alright, now I need to define the list of kanjis that I’m currently learning. This I need to do it manually, but later I’ll explain how to do it more dinamically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">kanji_learning <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"一"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"二"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"三"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"王"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"玉"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"十"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"五"</span>)</span></code></pre></div>
</div>
<p>Lastly, I’ll tell R to filter the jukugos that only include kanji that are on my learning list. I also want to sort the jukugos from more to less used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">jukugo_learning <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_jukugo <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(kanji_left <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> kanji_learning, kanji_right <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> kanji_learning) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(frequency))</span>
<span id="cb13-4"></span>
<span id="cb13-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(jukugo_learning)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     id comp_word frequency          grammatical_feature pronunciation
1 17059      二三        32 possible to use as an adverb         nisan
2 17059      二三        32 possible to use as an adverb         nisan
3 20330      三一        12                 general noun        sanpin
4 20330      三一        12                 general noun        sanpin
5 23443      一一         4 possible to use as an adverb        itiiti
6 23443      一一         4 possible to use as an adverb        itiiti
  english_translation position kanji kanji_id kanji_left kanji_right
1        two or three        L    二     1577         二          三
2        two or three        R    三      744         二          三
3 low-ranking samurai        R    一       41         三          一
4 low-ranking samurai        L    三      744         三          一
5          one-by-one        L    一       41         一          一
6          one-by-one        R    一       41         一          一</code></pre>
</div>
</div>
<p>The <code>filter()</code> function selects rows based on one or more conditions. I’ve passed two conditions: that <code>kanji_left</code> is included in the <code>kanji_learning</code> “list” (in R we’d call this a vector, not a list), and that <code>kanji_right</code> is also included in <code>kanji_learning</code>. The term “is included in” is represented in R with the operand <code>%in%</code>.</p>
<p>The <code>arrange()</code> function reorders the rows based on one or more variables. I’ve passed the argument <code>desc(frequency)</code> because I want the words to be sorted in descending order of frequency (from more to less frequency).</p>
<p>Now, something odd has happened: now we have two copies of each jukugo. These are complete duplicates in the dataset, with the only difference of which kanji appears in the variables <code>position</code>, <code>kanji</code>, and <code>kanji_id</code>. For example, “nisan” (二三) appears twice, one with <code>position</code> L, <code>kanji</code> 二, and <code>kanji_id</code> 1577, and another with <code>position</code> R, <code>kanji</code> 三, and <code>kanji_id</code> 744. This is somethin that I didn’t see first time I explored the dataset.</p>
<p>I could have done things differently. Instead of splitting the jukugos manually, I could have performed a “self-join” of the duplicated rows. But one cool thing about data cleaning and analysis is that there are always different ways to reach the same goal. It’s an iterative process, and by trial and error I can learn a lot and find alternative methods of doing things.</p>
<p>Moving forward, since I’m only interested in keeping one record of each jukugo, I can drop these duplicates. Aditionally, I’ll keep only the variables I’m interested in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">jukugo_learning <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> jukugo_learning <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(id, comp_word, frequency, grammatical_feature, pronunciation, english_translation, kanji_left, kanji_right) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb15-4"></span>
<span id="cb15-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(jukugo_learning)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     id comp_word frequency          grammatical_feature pronunciation
1 17059      二三        32 possible to use as an adverb         nisan
2 20330      三一        12                 general noun        sanpin
3 23443      一一         4 possible to use as an adverb        itiiti
4 25773      二王         2                 general noun          nioo
          english_translation kanji_left kanji_right
1                two or three         二          三
2         low-ranking samurai         三          一
3                  one-by-one         一          一
4 the two guardian Deva kings         二          王</code></pre>
</div>
</div>
<p>I’ve used two new <code>dplyr</code> functions: <code>select()</code> keeps some columns or variables, and <code>distinct()</code> keeps only non-duplicated rows.</p>
<p>The final result contains four distinct jukugos: 二三, 三一, 一一, and 二王. All of them are very low-frequency, with the most common of them appearing only 32 times.</p>
</section>
<section id="next-step-making-it-interactive" class="level1">
<h1>Next step: making it interactive</h1>
<p>So far, I have created a code that filters Japanese kanji words based on whatever Kanji components I want. However, the whole process would be nicer if I had a way of selecting the data interactivelly, maybe pressing some buttons. We can do just that using R Shiny applications. But that’s for another day!</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><a href="https://www.kanjidatabase.com/index.php">Kanji database</a>.</li>
</ul>


</section>

 ]]></description>
  <category>R</category>
  <category>data cleaning</category>
  <category>exploratory</category>
  <guid>https://CarlosEpiStats.github.io/blog/posts/kanji/post.html</guid>
  <pubDate>Mon, 26 Feb 2024 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Diagrama aluvial (alluvial plot)</title>
  <dc:creator>Carlos Fernández</dc:creator>
  <link>https://CarlosEpiStats.github.io/blog/posts/alluvial_plot/post.html</link>
  <description><![CDATA[ 



<section id="introducción" class="level1">
<h1>Introducción</h1>
<p>En este post explico cómo crear un diagrama aluvial (<em>alluvial plot</em>) usando código en R.</p>
<section id="qué-es-un-diagrama-aluvial" class="level2">
<h2 class="anchored" data-anchor-id="qué-es-un-diagrama-aluvial">Qué es un diagrama aluvial</h2>
<p>Un diagrama o gráfico aluvial muestra el flujo de información de un estadio al siguiente. El nombre “aluvial” alude a su parecido con el flujo de un río.</p>
</section>
<section id="para-qué-se-usan-los-diagramas-aluviales" class="level2">
<h2 class="anchored" data-anchor-id="para-qué-se-usan-los-diagramas-aluviales">Para qué se usan los diagramas aluviales</h2>
<p>Un diagrama aluvial se suele utilizar en las siguientes situaciones:</p>
<ul>
<li>Para mostrar el número de participantes de un estudio que cambian desde una categoría basal a una categoría siguiente. Por ejemplo, el número de participantes aleatorizados al principio del estudio y que continúan en seguimiento al final. Es un complemento gráfico a los diagramas de flujo, que presentan la información con flechas y cajas con texto y números.</li>
<li>Para mostrar la distribución de participantes entre distintas variables categóricas. En este caso es una alternativa más “vistosa” a los diagramas de columnas apilados.</li>
</ul>
</section>
</section>
<section id="código-en-r" class="level1">
<h1>Código en R</h1>
<section id="preparativos" class="level2">
<h2 class="anchored" data-anchor-id="preparativos">Preparativos</h2>
<p>Para este ejemplo, usaremos la biblioteca <code>ggalluvial</code> y <code>ggplot2</code>. Los datos proceden de un estudio sobre aprendizaje de idiomas usando la aplicación web <em>LingQ</em> (<a href="http://comparelanguageapps.com/documentation/LingQ_Efficacy_2023.pdf">Enlace al artículo</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cargar las bibliotecas necesarias</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Incluye ggplot2</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggalluvial)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(knitr)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Datos de ejemplo</span></span>
<span id="cb1-7"></span>
<span id="cb1-8">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb1-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Inicial =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Primero"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Segundo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tercero"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cuarto+"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb1-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Final =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Primero"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Segundo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tercero"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cuarto+"</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), </span>
<span id="cb1-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Frecuencia =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-12">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb1-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Inicial =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Inicial, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Primero"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Segundo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tercero"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cuarto+"</span>)),</span>
<span id="cb1-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Final =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Final, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Primero"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Segundo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tercero"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cuarto+"</span>))</span>
<span id="cb1-16">  )</span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Inicial   Final Frecuencia
1 Primero Primero         28
2 Primero Segundo         28
3 Primero Tercero         10
4 Primero Cuarto+          4
5 Segundo Primero          3
6 Segundo Segundo          6</code></pre>
</div>
</div>
<p>En este estudio, un total de 192 personas fueron seleccionados para la muestra y completaron el test de conocimientos inicial. De ellas, 101 completaron el test final y estudiaron al menos dos horas en la aplicación, y fueron incluidas en el análisis. Los datos muestran cuál era el conocimiento de idiomas equivalente en semestres de educación formal (“Primero”, “Segundo”, “Tercero”, “Cuarto o más”) al principio del estudio (“Inicial”) y tras usar la aplicación (“Final”).</p>
<p><em>Nota: Los datos se han extraído del artículo de ejemplo a partir de las tablas de resultados y son solo un ejemplo de una distribución de datos compatible con esos resultados.</em></p>
</section>
<section id="gráfico" class="level2">
<h2 class="anchored" data-anchor-id="gráfico">Gráfico</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Diagrama aluvial</span></span>
<span id="cb3-2">data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(Inicial), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(Final),</span>
<span id="cb3-4">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Frecuencia)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inicial"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Final"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_alluvium</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Final)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_stratum</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stratum"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">after_stat</span>(stratum))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Semestres equivalentes de educación formal"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://CarlosEpiStats.github.io/blog/posts/alluvial_plot/post_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En el diagrama aluvial, el área de las zonas coloreadas es proporcional a la frecuencia, por lo que “flujos” más anchos representan más participantes.</p>
<p>En el gráfico se aprecia cómo la mayor parte del flujo ocurre de abajo arriba; es decir, el conocimiento tiende a mejorar más que a empeorar. Por ejemplo, más de la mitad de los participantes que partían del primer semestre de conocimientos subieron al segundo, tercer o cuarto semestre.</p>
<p>También se puede ver como casi todos los participantes que acabaron con un nivel de conocimientos equivalente al primer semestre partían de ese nivel previo, y unos pocos bajaron del segundo semestre al primer semestre.</p>
<p>En definitiva, los diagramas aluviales proporcionan una opción visual para entender mejor los flujos de datos entre categorías, especialmente si hay algún componente temporal asociado a ellas.</p>
</section>
</section>
<section id="referencias" class="level1">
<h1>Referencias</h1>
<ul>
<li><a href="https://corybrunson.github.io/ggalluvial/">Biblioteca ggalluvial</a></li>
<li><a href="http://comparelanguageapps.com/documentation/LingQ_Efficacy_2023.pdf">Estudio de aprendizaje de idiomas con LingQ</a></li>
</ul>


</section>

 ]]></description>
  <category>ggplot</category>
  <category>plot</category>
  <category>alluvial</category>
  <guid>https://CarlosEpiStats.github.io/blog/posts/alluvial_plot/post.html</guid>
  <pubDate>Wed, 21 Feb 2024 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Lasso regression</title>
  <dc:creator>Carlos Fernández</dc:creator>
  <link>https://CarlosEpiStats.github.io/blog/posts/lasso_regression/post.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this post, I explain what Lasso regression is, what it is used for, and how to use it, with code in R.</p>
<section id="what-is-lasso-regression" class="level2">
<h2 class="anchored" data-anchor-id="what-is-lasso-regression">What is Lasso regression?</h2>
<p>Lasso regression is a modified version of linear regression whose objective is to find the simplest model possible. In order to do that, Lasso method penalizes large regression coefficients, leaving smaller coefficients and even removing some variables from the final model (i.e., setting their coefficients to zero).</p>
<p>Lasso is an acronym of <strong>L</strong>east <strong>A</strong>bsolute <strong>S</strong>hrinkage and <strong>S</strong>elector <strong>O</strong>perator.</p>
</section>
<section id="what-is-lasso-regression-used-for" class="level2">
<h2 class="anchored" data-anchor-id="what-is-lasso-regression-used-for">What is Lasso regression used for?</h2>
<p>Lasso regression is used mainly in two applications:</p>
<ul>
<li>Model variable selection: Lasso can be used as a method to select the most important variables in a regression model. The least important variables will have their coefficients set to zero, effectively being removed from the final model.</li>
<li>Parameter shrinkage: Lasso’s coefficients are smaller thant those of a simple lineal regression. This helps to avoid overfitting problems.</li>
</ul>
<p>Given their two main functions, Lasso regression is usually employed in the following situations:</p>
<ul>
<li>When we have a <strong>high-dimensionality</strong> dataset, i.e., with a large number of variables.</li>
<li>When we have <strong>multicolineallity</strong> in our model, i.e., several variables are lineally dependent of one another.</li>
<li>When we want to <strong>automatize the model building</strong>, via automatizing the selection of the included variables.</li>
</ul>
</section>
<section id="how-does-lasso-regression-work" class="level2">
<h2 class="anchored" data-anchor-id="how-does-lasso-regression-work">How does Lasso regression work?</h2>
<p>A traditional multivariable lineal regression model finds a set of regression coefficients (<img src="https://latex.codecogs.com/png.latex?%5Cbeta_0,%20%5Cbeta_1,%20%5Cbeta_2...">) that minimizes the residuals’ squared sum (RSS). That is, the distance between the datapoints and the model predictions.</p>
<p>Lasso regression adds another parameter called L1. L1 is defined as the sum of the absolute values of the model coefficients. Lasso method tries to minimize the sum of RSS and L1. As a consequence, Lasso finds a model with smaller regression coefficients. This whole process is known as “L1 regularization”, and it produces a coefficient “shrinkage”.</p>
<p>Every time we run a Lasso regression, whe need to specify the <strong>lambda</strong> parameter (<img src="https://latex.codecogs.com/png.latex?%5Clambda">). Lambda represents the relative importance of the L1 parameter compared to the RSS part of the minimization formula.</p>
<ul>
<li>With <img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%200">, there is no coefficient shrinkage, and the Lasso model is effectively equal to a regular linear regression model.</li>
<li>As <img src="https://latex.codecogs.com/png.latex?%5Clambda"> grows, there is more shrinkage, and more variables are removed from the model.</li>
<li>If <img src="https://latex.codecogs.com/png.latex?%5Clambda"> were to be infinite, all coefficients would be removed, and we would end up with an empty model.</li>
</ul>
<section id="lasso-regression-formula" class="level3">
<h3 class="anchored" data-anchor-id="lasso-regression-formula">Lasso regression formula</h3>
<p><img src="https://latex.codecogs.com/png.latex?min(RSS%20+%20%5Clambda%20%5Csum%20%7C%5Cbeta_j%7C)"></p>
<p>Where</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?RSS"> es the residuals’ square sum.</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Clambda"> is Lasso’s penalizing factor.</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Csum%20%7C%5Cbeta_j%7C"> is the sum of the absolute values of the regression coefficients.</li>
</ul>
</section>
</section>
</section>
<section id="code-in-r" class="level1">
<h1>Code in R</h1>
<section id="getting-ready" class="level2">
<h2 class="anchored" data-anchor-id="getting-ready">Getting ready</h2>
<p>In this example, we’ll use the <code>glmnet</code> library and the example dataset in <code>mtcars</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("glmnet") # Install the package (only once)</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glmnet)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(mtcars)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
</div>
<p>We’ll use <code>mpg</code> (miles per galon) as the outcome variable, and <code>cyl</code> (number of cylinders), <code>hp</code> (horsepower), <code>wt</code> (weight), <code>gear</code> (gear number) y <code>drat</code> (axis relation?) as predictive variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the outcome variable</span></span>
<span id="cb3-2">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mtcars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the predictive variables</span></span>
<span id="cb3-5">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.matrix</span>(mtcars[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hp"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drat"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gear"</span>)])</span></code></pre></div>
</div>
</section>
<section id="choose-a-value-for-lambda" class="level2">
<h2 class="anchored" data-anchor-id="choose-a-value-for-lambda">Choose a value for lambda</h2>
<p>Podemos elegir el valor de <img src="https://latex.codecogs.com/png.latex?%5Clambda"> que minimice el error cuadrado medio (<em>mean-squared error</em>, MSE). La función <code>cv.glmnet()</code> realiza “validación cruzada de k iteraciones” (<a href="https://www.statology.org/k-fold-cross-validation/">K-fold cross-validation</a>) para identificar este valor de <img src="https://latex.codecogs.com/png.latex?%5Clambda">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># validación cruzada</span></span>
<span id="cb4-2">cv_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cambiar el parámetro alpha da lugar a otros tipos de regresión</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># encontrar el valor lambda que minimiza el MSE</span></span>
<span id="cb4-5">best_lambda <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cv_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lambda.min</span>
<span id="cb4-6">best_lambda</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.315814</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mostrar los resultados en un gráfico</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(cv_model)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://CarlosEpiStats.github.io/blog/posts/lasso_regression/post_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El valor de lambda que minimiza el MSE resulta ser 0.315814, que en la gráfica corresponde al punto <img src="https://latex.codecogs.com/png.latex?Log(%5Clambda)"> = -1.1526019.</p>
</section>
<section id="ajustar-el-modelo" class="level2">
<h2 class="anchored" data-anchor-id="ajustar-el-modelo">Ajustar el modelo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># coeficientes del modelo </span></span>
<span id="cb7-2">best_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glmnet</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> best_lambda)</span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(best_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6 x 1 sparse Matrix of class "dgCMatrix"
                     s0
(Intercept) 35.74777065
cyl         -0.83999245
hp          -0.01680443
wt          -2.89776526
drat         0.36928132
gear         .         </code></pre>
</div>
</div>
<p>Podemos observar como el coeficiente de <code>gear</code> aparece como un punto, lo que indica que la regresión Lasso ha eliminado el coeficiente, ya que la variable no era lo suficientemente importante.</p>
</section>
<section id="comparación-con-la-regresión-lineal-sin-lasso" class="level2">
<h2 class="anchored" data-anchor-id="comparación-con-la-regresión-lineal-sin-lasso">Comparación con la regresión lineal sin Lasso</h2>
<p>Como comparación, podemos ver los coeficientes que resultarían de un modelo de regresión lineal múltiple sin contracción de parámetros ni selección de variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">linear_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> cyl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> wt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> drat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gear, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mtcars)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(best_model), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linear"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(linear_model))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6 x 2 sparse Matrix of class "dgCMatrix"
                     s0      Linear
(Intercept) 35.74777065 33.99417771
cyl         -0.83999245 -0.72169272
hp          -0.01680443 -0.02227636
wt          -2.89776526 -2.92715539
drat         0.36928132  0.73105753
gear         .           0.16750690</code></pre>
</div>
</div>
<p>Los coeficientes del modelo Lasso se han contraído un poco, especialmente de la variable <code>drat</code>, y la variable <code>gear</code> ha sido automáticamente excluida.</p>
</section>
</section>
<section id="dudas-y-curiosidades" class="level1">
<h1>Dudas y curiosidades</h1>
<p>Algunas preguntas que me surgen para investigar y escribir nuevos posts:</p>
<ul>
<li>¿Cómo elegir el valor de lambda?</li>
<li>¿Qué es el método de <em>K-fold cross-validation</em>?</li>
<li>¿Qué diferencia a Lasso de otros modelos similares como Ridge?</li>
<li>¿Qué utilidad tiene la regresión Lasso en el mundo de la salud pública? ¿Qué base de datos puedo usar como ejemplo?</li>
<li>¿Qué artículos hay publicados con esta metodología?</li>
</ul>
</section>
<section id="referencias" class="level1">
<h1>Referencias</h1>
<ul>
<li><a href="https://www.statology.org/lasso-regression-in-r/">Statology</a></li>
<li><a href="https://www.geeksforgeeks.org/lasso-regression-in-r-programming/">Geeks for Geeks</a></li>
</ul>


</section>

 ]]></description>
  <category>regression</category>
  <category>R</category>
  <category>lasso</category>
  <guid>https://CarlosEpiStats.github.io/blog/posts/lasso_regression/post.html</guid>
  <pubDate>Mon, 05 Feb 2024 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Series: ggplot2-tips</title>
  <dc:creator>Carlos Fernández</dc:creator>
  <link>https://CarlosEpiStats.github.io/blog/posts/ggplot2-tips/ggplot-series.html</link>
  <description><![CDATA[ 








<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div> ]]></description>
  <guid>https://CarlosEpiStats.github.io/blog/posts/ggplot2-tips/ggplot-series.html</guid>
  <pubDate>Tue, 27 Feb 2024 10:05:09 GMT</pubDate>
</item>
</channel>
</rss>
